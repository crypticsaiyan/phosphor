================================================================================
KIRO AZURE IRC BOT - ARCHITECTURE DIAGRAM
================================================================================

HIGH-LEVEL FLOW:
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   IRC User      â”‚
    â”‚  (in channel)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Types: /ai list containers
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         IRC Server                      â”‚
    â”‚      (irc.libera.chat)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ PRIVMSG #channel :/ai list containers
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    Kiro Azure IRC Bot                   â”‚
    â”‚    (kiro_azure_irc_bot.py)              â”‚
    â”‚                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  IRC AI Handler                    â”‚ â”‚
    â”‚  â”‚  - Parse /ai command               â”‚ â”‚
    â”‚  â”‚  - Check rate limiting             â”‚ â”‚
    â”‚  â”‚  - Extract question                â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚           â”‚                              â”‚
    â”‚           â†“                              â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Azure Container Manager           â”‚ â”‚
    â”‚  â”‚  - Check cache (30s TTL)           â”‚ â”‚
    â”‚  â”‚  - Authenticate with Azure         â”‚ â”‚
    â”‚  â”‚  - Query container metadata        â”‚ â”‚
    â”‚  â”‚  - Process natural language        â”‚ â”‚
    â”‚  â”‚  - Format response                 â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                  â”‚                  â”‚
                â†“                  â†“                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Azure           â”‚  â”‚  Container   â”‚  â”‚  Container   â”‚
    â”‚  Management API  â”‚  â”‚  Health      â”‚  â”‚  Health      â”‚
    â”‚                  â”‚  â”‚  Endpoint    â”‚  â”‚  Endpoint    â”‚
    â”‚  - List          â”‚  â”‚  /health     â”‚  â”‚  /health     â”‚
    â”‚    containers    â”‚  â”‚              â”‚  â”‚              â”‚
    â”‚  - Get metadata  â”‚  â”‚  HTTP GET    â”‚  â”‚  HTTP GET    â”‚
    â”‚  - Get status    â”‚  â”‚  Response:   â”‚  â”‚  Response:   â”‚
    â”‚                  â”‚  â”‚  {status:ok} â”‚  â”‚  {status:ok} â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Returns container data
                â”‚
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    Response Processing                  â”‚
    â”‚    - Format as human-readable           â”‚
    â”‚    - Split long messages                â”‚
    â”‚    - Add emojis                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ PRIVMSG #channel :ğŸ’¡ Found 2 containers...
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         IRC Server                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   IRC User      â”‚
    â”‚  (sees answer)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DETAILED COMPONENT BREAKDOWN:
================================================================================

1. IRC CONNECTION (miniirc library)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  - Connects to IRC server              â”‚
   â”‚  - Joins specified channels            â”‚
   â”‚  - Listens for PRIVMSG events          â”‚
   â”‚  - Handles PING/PONG                   â”‚
   â”‚  - Sends responses back                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. IRC AI HANDLER (src/irc_ai_handler.py)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Message Parsing:                      â”‚
   â”‚    - Detect /ai prefix                 â”‚
   â”‚    - Extract question text             â”‚
   â”‚    - Identify user and channel         â”‚
   â”‚                                         â”‚
   â”‚  Rate Limiting:                        â”‚
   â”‚    - Track last command per user       â”‚
   â”‚    - 10 second cooldown (configurable) â”‚
   â”‚    - Prevent spam                      â”‚
   â”‚                                         â”‚
   â”‚  Response Formatting:                  â”‚
   â”‚    - Split long messages               â”‚
   â”‚    - Add emojis (ğŸ¤– ğŸ’¡ âœ… âŒ)          â”‚
   â”‚    - Handle multi-line output          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. AZURE CONTAINER MANAGER (src/azure_container_manager.py)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Authentication:                       â”‚
   â”‚    - Service Principal credentials     â”‚
   â”‚    - ClientSecretCredential            â”‚
   â”‚    - Azure Management API access       â”‚
   â”‚                                        â”‚
   â”‚  Caching:                              â”‚
   â”‚    - 30 second TTL                     â”‚
   â”‚    - Reduces API calls                 â”‚
   â”‚    - Improves response time            â”‚
   â”‚                                        â”‚
   â”‚  Container Queries:                    â”‚
   â”‚    - List all containers               â”‚
   â”‚    - Get specific container            â”‚
   â”‚    - Filter by status/location         â”‚
   â”‚                                        â”‚
   â”‚  Health Checks:                        â”‚
   â”‚    - HTTP GET to /health               â”‚
   â”‚    - 5 second timeout                  â”‚
   â”‚    - Response time tracking            â”‚
   â”‚                                        â”‚
   â”‚  Natural Language Processing:          â”‚
   â”‚    - Keyword matching                  â”‚
   â”‚    - Context-aware responses           â”‚
   â”‚    - Human-readable formatting         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. AZURE MANAGEMENT API
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Endpoints Used:                       â”‚
   â”‚    - container_groups.list_by_rg()     â”‚
   â”‚    - container.instance_view           â”‚
   â”‚                                        â”‚
   â”‚  Data Retrieved:                       â”‚
   â”‚    - Container name                    â”‚
   â”‚    - IP address                        â”‚
   â”‚    - Exposed ports                     â”‚
   â”‚    - Status (Running/Stopped)          â”‚
   â”‚    - Location/region                   â”‚
   â”‚    - CPU/Memory allocation             â”‚
   â”‚    - Restart count                     â”‚
   â”‚    - Start time                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATA FLOW EXAMPLE:
================================================================================

User Input:
  /ai what is the IP of web-api?

Step 1: IRC Handler receives message
  - Detects /ai prefix âœ“
  - Extracts question: "what is the IP of web-api?"
  - Checks rate limit: OK âœ“
  - Sends "Processing..." message

Step 2: Azure Container Manager processes query
  - Checks cache: Valid (< 30s old) âœ“
  - Reads cached container data
  - Searches for "web-api" in container names
  - Finds match: {name: "web-api", ip: "20.123.45.67", ...}
  - Formats response: "web-api: 20.123.45.67"

Step 3: Response sent back
  - IRC Handler receives answer
  - Formats: "ğŸ’¡ web-api: 20.123.45.67"
  - Sends to IRC channel
  - User sees response (< 2 seconds total)


AUTHENTICATION FLOW:
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  .env file      â”‚
    â”‚  - CLIENT_ID    â”‚
    â”‚  - SECRET       â”‚
    â”‚  - TENANT_ID    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ClientSecretCredential         â”‚
    â”‚  (Azure Identity SDK)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Azure AD Authentication        â”‚
    â”‚  - Validates credentials        â”‚
    â”‚  - Issues access token          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Azure Management API           â”‚
    â”‚  - Accepts token                â”‚
    â”‚  - Checks RBAC permissions      â”‚
    â”‚  - Returns container data       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CACHING STRATEGY:
================================================================================

First Request:
  User: /ai list containers
    â†’ Cache: MISS
    â†’ Azure API: Called
    â†’ Response time: ~2-3 seconds
    â†’ Cache: STORED (TTL: 30s)

Second Request (within 30s):
  User: /ai show IPs
    â†’ Cache: HIT
    â†’ Azure API: NOT called
    â†’ Response time: ~0.5 seconds
    â†’ Cache: USED

After 30 seconds:
  User: /ai check status
    â†’ Cache: EXPIRED
    â†’ Azure API: Called
    â†’ Response time: ~2-3 seconds
    â†’ Cache: REFRESHED


RATE LIMITING:
================================================================================

User "alice" sends: /ai list containers
  â†’ Timestamp stored: 10:00:00
  â†’ Response sent âœ“

User "alice" sends: /ai show IPs (at 10:00:05)
  â†’ Check: 5 seconds since last command
  â†’ Cooldown: 10 seconds required
  â†’ Response: "Please wait 5s before next query"
  â†’ Request blocked âœ—

User "bob" sends: /ai check health (at 10:00:05)
  â†’ Check: No previous command from bob
  â†’ Response sent âœ“
  â†’ Different users don't affect each other


ERROR HANDLING:
================================================================================

Scenario 1: Azure API Timeout
  â†’ Catch exception
  â†’ Return cached data (if available)
  â†’ Send: "Using cached data (Azure API slow)"

Scenario 2: Authentication Failure
  â†’ Catch exception
  â†’ Send: "I can't reach Azure right now â€” try again later"
  â†’ Log error for debugging

Scenario 3: Container Health Check Timeout
  â†’ Catch timeout exception
  â†’ Send: "Health check timed out"
  â†’ Continue with other containers

Scenario 4: No Containers Found
  â†’ Check if resource group is empty
  â†’ Send: "No containers found in resource group"
  â†’ Suggest checking configuration


DEPLOYMENT OPTIONS:
================================================================================

Option 1: Local Machine
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Your Laptop     â”‚
  â”‚  - Run bot       â”‚
  â”‚  - Keep terminal â”‚
  â”‚    open          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Internet
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Azure           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 2: Azure VM
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Azure VM        â”‚
  â”‚  - systemd       â”‚
  â”‚  - Always on     â”‚
  â”‚  - Fast access   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Azure VNet
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Containers      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 3: Azure Container Instance
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Bot Container   â”‚
  â”‚  - Serverless    â”‚
  â”‚  - Cheap         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Azure VNet
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  App Containers  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SECURITY LAYERS:
================================================================================

Layer 1: Azure Authentication
  - Service Principal with Reader role
  - Minimum required permissions
  - Credentials in .env (not in code)

Layer 2: IRC Rate Limiting
  - Per-user cooldown
  - Prevents spam
  - Protects Azure API quota

Layer 3: Network Security
  - NSG rules for container access
  - Optional: Private VNet
  - Optional: VPN for bot access

Layer 4: Secret Management
  - .env excluded from git
  - No hardcoded credentials
  - Optional: Azure Key Vault


MONITORING POINTS:
================================================================================

1. Bot Health
   - IRC connection status
   - Message processing rate
   - Error frequency

2. Azure API
   - Request count
   - Response time
   - Throttling events

3. Container Health
   - Health check success rate
   - Response times
   - Timeout frequency

4. User Activity
   - Commands per user
   - Rate limit hits
   - Popular queries

================================================================================
